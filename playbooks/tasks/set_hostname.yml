- name: Get current hostname
  ansible.builtin.command:
    cmd: hostname
  register: current_hostname
  changed_when: false  # This ensures it does not falsely report a "change".

- name: Change the hostname
  ansible.builtin.hostname:
    name: "{{ new_hostname | upper }}"
  register: hostname_change_output
  ignore_errors: true

- name: Set default result if hostname change task resulted in no changes
  ansible.builtin.set_fact:
    hostname_change_output:
      skipped: true
      msg: "Hostname change was skipped as it is already set correctly."
  when: not hostname_change_output.changed
